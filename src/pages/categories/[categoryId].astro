---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import SongSearch from "@/components/song-search.astro";

export async function getStaticPaths() {
    const perGameCategories = await getCollection("categories");
    const songs = await getCollection("songs");

    const categoryIds = perGameCategories
        .map((collection) =>
            collection.data.categories.map((category) => category.id),
        )
        .flat();

    return categoryIds.map((categoryId) => ({
        params: { categoryId },
        props: {
            songs: songs.flatMap((song) =>
                song.data.category.id === categoryId ? [song.data] : [],
            ),
        },
    }));
}

const { songs } = Astro.props;
---

<Layout>
    <SongSearch songs={songs} />
</Layout>
